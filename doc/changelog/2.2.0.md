# 2.2.0

### Retry functionality

Tests can now have automatic retry on errors and failures.
Use `.withRetryPolicy` on `Test{,WithInitialState}` and `RunnableTest` to add
retry capabilities to your test; there are a number of predefined retry policies
available from `Retry.Policy`.


### Selenium support

* Add a Selenium-based DomZipper.
* Add a Selenium extension module including:
  * multiple (browser-) tab support
  * multiple browser (instance) support
  * maximise parallelism and concurrency by having a browser pool and safely
    spreading tabs across them
  * extension methods to Selenium classes:
    * `WebDriver`
    * `WebElement`
    * `Point`

## Other

* Changes to `TestWithInitialState`:
  * Add `def withRef(ref: R)`
  * Add `def withRefByName(ref: => R)`
  * Add `def withLazyRef(ref: => R)`
  * Add `def withoutRef(implicit ev: Unit =:= R)`
  * `run` is now deprecated - use one of the above
* Add Focus DSL for `Option`s.
* Tweak equality assertion failure message.
* {In,de}crease assertions now clearer in reports.
* Rename `Recover[E]` typeclass to `Attempt[E]`
* Add a cross-compiled `DomZipperModule`.
* Deprecate `Report#assertF()`; use `Report#assert(useFailSettingsOnPass = true)` instead
* Deprecate `Report#formatF()`; use `Report#format(useFailSettingsOnPass = true)` instead
* Deprecate `.mapZippers` in DomZipper collection; use `.map` instead
* Add more DSL useful for observation partiality; see `StdlibUtil.scala`
* Add to `DomZipper`
  * `getAttribute(name): Option[String]`
  * `needAttribute(name): String`
  * `child(css?, m of n?)`
  * `.children01` & `.children01(css)`
  * `.children0n` & `.children0n(css)`
  * `.children1n` & `.children1n(css)`
  * `.classes: Set[String]`
  * `.exists(css, filter): Boolean`
  * `.matches(css): Boolean`
* Add to `DomZipper.collect` results
  * `.filter`
* Bugfixes:
  * Calling `.updateState` on a group of actions should run after all actions, not on each inner action.
  * Calling `.updateState` on an empty action turn it into a non-empty action (rather than discarding the state update)
  * Coloured reports now display as intended, on OS X
* Reports are now printed in a mutex with buffers flushed
* Add `Attempt.toStringWithStackTrace`
* Add to `Report`
  * `print` to print the report to stdout
  * `exception` to get an exception that best describes the test failure
* Report format
  * multi-line failure messages now supported
  * failure detail can be highlighted differently than the failed test step
  * by default, failure detail is now dark red (where as it used to be bright red)
  * when collection equality fails the results now span two lines with the output aligned
* `ROS` is now a subtype of `OS`
* Upgrade Cats        to 1.1.0
* Upgrade Scala       to 2.12.6
* Upgrade Scalaz      to 7.2.25
* Upgrade ScalaJs DOM to 0.9.6
* Upgrade Scala.JS    to 0.6.24

## Migration

```sh
find . -name '*.scala' -type f -exec perl -pi -e 's/(?<!\w)mapZippers(?!\w)/map/g' {} +
```
